<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Forgot Password</title>
    <link rel="stylesheet" href="css/forgot.css" />
    <link rel="icon" type="image/png" href="login/images/icons/civicon.png" />
  </head>

  <body>
    <div class="header-container">
      <div class="header-left">CIVICALL</div>
      </div>
    </div>

    <div class="reset-container">
      <h1>Reset your password</h1>
      <hr />
      <p>
        Please insert your Email or Phonee number to get the code to reset your
        password
      </p>
    <!-- Inside the reset-container div -->
<form id="resetForm">
  <div class="reset-method">
    <input type="text" id="emailInput" placeholder="Enter your Email" />
    <button class="proceed-button" id="buttonReset">Proceed</button>
  </div>
</form>

    </div>
    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getAuth, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
      import {
        getDatabase,
        ref,
        get,
        push,
        set,
        onValue,
        onChildRemoved,
        orderByChild,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
  
    
      const firebaseConfig = {
        apiKey: "AIzaSyAMl8Eq_Clwyaw4w4D_TTrmOan9osHooMY",
        authDomain: "civicall-app-a54d1.firebaseapp.com",
        databaseURL: "https://civicall-app-a54d1-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "civicall-app-a54d1",
        storageBucket: "civicall-app-a54d1.appspot.com",
        messagingSenderId: "909514632764",
        appId: "1:909514632764:web:bc969936e31a4fba9e9d39",
        measurementId: "G-0BVYE5XJGV",
      };
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const auth = getAuth(app);


      document.getElementById("resetForm").addEventListener("submit", async function (event) {
  event.preventDefault();

  const email = document.getElementById("emailInput").value;

  if (email) {
    // Reference to the SuperAdminAcc node
    const superAdminAccRef = ref(db, 'SuperAdminAcc');

    // Check if the email exists in the SuperAdminAcc node
    const emailExists = await new Promise((resolve) => {
      onValue(superAdminAccRef, (snapshot) => {
        const users = snapshot.val();

        // Check if the email exists in the SuperAdminAcc node
        const emailExists = Object.values(users).some(user => user.email === email);

        resolve(emailExists);
      });
    });

    if (emailExists) {
      // Email exists, proceed with sending a password reset email

      // Use Firebase Authentication to send a password reset email
      sendPasswordResetEmail(auth, email)
        .then(() => {
          alert("Password reset email sent. Please check your email.");

          // Update the Realtime Database with the user's email
          const user = auth.currentUser;

          if (user) {
            const uid = user.uid;
            const dbRef = ref(db, `SuperAdminAcc/${uid}`);
            set(dbRef, { email });
          } else {
            console.error("User not found.");
          }
        })
        .catch((error) => {
          console.error("Error sending password reset email:", error.message);
          alert("Error sending password reset email. Please try again.");
        });
    } else {
      // Email doesn't exist in the SuperAdminAcc node
      alert("Email not found. Please enter a valid email address.");
    }
  } else {
    alert("Please enter your email address.");
  }
});



    </script>
  </body>
</html>